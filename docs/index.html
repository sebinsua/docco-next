<!DOCTYPE html>

<html>
<head>
  <title>Docco Next</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p><a href="https://github.com/mobily-enterprises/docco-next">Docco Next</a> facilitates
<a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a>
in several languages. It’s written in modern Javascript, and runs in Node.</p>
<p>See the <a href="https://mobily-enterprises.github.io/docco-next/">generated documentation as HTML</a></p>
<h2 id="install-and-use">Install and use</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p>To use Docco Next run <code>npm install -g docco-next</code> and run it passing it a list of files
(e.g. <code>docco src/*js</code>)</p>
<p>By default, every file will be converted into formatted HTML and will be placed in the
default destination directory (<code>docs</code> by default). It’s also possible to
convert files to Markdown, rather than HTML. Note that files will
retain their original names and will change their extension to <code>html</code>.</p>
<h2 id="is-it-literate-programming">Is it literate programming?</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Formally speaking, literate programs put documentation strictly first.</p>
<p>In simple words, a literate file will look like a Markdown file, and its
code is whichever Markdown code is included in the file.
This means that anything that is not Markdown code (and is therefore indented in) is
considered documentation, and programs are organised so that the documentation
actually makes sense.</p>
<p>A notable example is CoffeeScript, which supports .litcoffee files natively.</p>
<p>However, not many languages support literate programming. Most languages will
need a proprocessor, for example to convert the <code>.js.md</code> file into <code>.js</code>.
<a href="https://github.com/vijithassar/lit">lit</a> is one of such tools. In Node, you
can use Rich Harris’s <a href="https://github.com/Rich-Harris/lit-node">lit-node</a>
to require .md files directly.</p>
<p>Docco Next works with normal source code (such as <code>.js</code> or <code>.c</code>) as well as literate
source code (such as literate CoffeeScript, <code>.litcoffee</code>, or <code>.js.md</code>).</p>
<p>With pure literate style, all you have to do is add the .md extension to your
source file.</p>
<p>When processing source files (such as <code>.js</code> or <code>.c</code>), one line comments are considered
documentation and are parsed using Markdown. The code (that is, anything that is
not a one-line comment)  is processed by <a href="https://shiki.matsu.io/">Shiki</a>.</p>
<p>In both cases, the end result is a set of HTML pages with your documentation.</p>
<h2 id="similar-projects">Similar projects</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Here is a list of <em>active</em> projects which achieve similar goals:</p>
<ul>
<li><p><a href="https://github.com/jashkenas/docco">Docco</a> by Jeremy Ashkenas (the same
wise author of Underscore and Backbone). The program that
inspired many others (including me) to use literate programming techniques and
implement code that facilitates it</p>
</li>
<li><p><a href="https://github.com/pycco-docs/pycco">pycco</a> by Nick Fitzgerald. A Python
implementation of literate programming</p>
</li>
<li><p><a href="https://github.com/gdeer81/marginalia">Marginalia</a> by Gary Deer. A <strong>Clojure</strong>
implementation of literate programing. The project was originally started by Michael Fogus.</p>
</li>
</ul>
<p>This file is the full source code of Docco Next, and it explains how it works in
pure literate style.</p>
<h2 id="required-files-and-starting-configuration">Required files and starting configuration</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>The following libraries are required by Docco Next:</p>
<ul>
<li><code>ejs</code>. Used to convert the layout master file into HTML</li>
<li><code>fs-extra</code>. Used for all I/O operations</li>
<li><code>marked</code>. Used to convert Markdown into HTML</li>
<li><code>commander</code>. Used to interpret command line parameters</li>
<li><code>shiki</code>. Used to highlight source code</li>
</ul>
<p>In Javascript terms, this becomes:</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 77;"><span class="line" id="L77"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;path&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L78"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">ejs</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;ejs&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L79"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;fs-extra&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L80"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">marked</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;marked&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L81"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">commander</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;commander&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L82"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">shiki</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;shiki&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line" id="L83"></span>
<span class="line empty-line" id="L84"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>On startup, the <code>version</code> variable is worked out straight from the <code>package.json</code>
file, which is loaded using <code>require</code></p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 86;"><span class="line" id="L86"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">pkg</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;./package.json&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L87"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">version</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">pkg</span><span style="color: #24292EFF">.version</span></span>
<span class="line empty-line" id="L88"></span>
<span class="line empty-line" id="L89"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Docco Next manages several languages, stored in <code>layouts/languages.json</code>.
Users can add more languages if desired. However, the list of default languages
(and their relevant information) is stored in <code>layouts/languages.json</code></p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 92;"><span class="line" id="L92"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">defaultLanguages</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;./layouts/languages.json&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line" id="L93"></span>
<span class="line empty-line" id="L94"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>By default, <code>marked</code> is run with very basic options (basically, just turning
<code>smartypants</code> on). Users can add more options, but this is the starting point</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 96;"><span class="line" id="L96"><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">defaultMarkedOptions</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> { smartypants</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">true</span><span style="color: #24292EFF"> }</span></span>
<span class="line empty-line" id="L97"></span>
<span class="line empty-line" id="L98"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <h2 id="configuration">Configuration</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>The <code>run</code> function is the entry point of the script when it’s run by the
command line (that is, it’s not being used as a library).
The <code>docco</code> command in <code>bin</code> simply runs <code>require(&#39;../docco.js&#39;).run()</code>.</p>
<p>The package <code>commander</code> will be used to parse command-line parameters.
Commander will generate a configuration object based on how it’s configured
using its <code>option</code> method.</p>
<p>For example the line:</p>
<pre><code><pre class="shiki" style="background-color: transparent"><code ><span class="line"><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-L, --languages [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use a custom languages.json&#39;</span><span style="color: #24292EFF">)</span></span></code></pre></code></pre><p>Means that if Docco Next is run with <code>--languages ./some/file.json</code>, the config
object will include <code>{ languages: &quot;./some/file.json&quot;}</code>.</p>
<p>Commander also provides the handy <code>helpInformation()</code> method, which will print
out how the command is used.</p>
<p>This is the full set of options available in Docco Next:</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 119;"><span class="line" id="L119"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">run</span><span style="color: #24292EFF"> (args </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">process</span><span style="color: #24292EFF">.argv) {</span></span>
<span class="line" id="L120"><span style="color: #24292EFF">  commander</span></span>
<span class="line" id="L121"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.name</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;docco&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L122"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.version</span><span style="color: #24292EFF">(version)</span></span>
<span class="line" id="L123"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.usage</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;[options] files&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L124"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-L, --languages [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use a custom languages.json&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L125"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L126"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;-l, --layout [name]&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L127"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;choose a layout (default, parallel or classic)&#39;</span></span>
<span class="line" id="L128"><span style="color: #24292EFF">    )</span></span>
<span class="line" id="L129"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-s, --shiki-theme [shikiTheme]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;choose a shiki theme&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L130"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-o, --output [path]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;output to a given folder&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L131"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-c, --css [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use a custom css file&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L132"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-p, --plugin [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use a custom plugin file&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L133"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-t, --template [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use a custom .ejs template&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L134"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L135"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;-e, --inputExtension [ext]&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L136"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;assume a file extension for all inputs&#39;</span></span>
<span class="line" id="L137"><span style="color: #24292EFF">    )</span></span>
<span class="line" id="L138"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;-m, --marked [file]&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;use custom marked options&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L139"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.option</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L140"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;-x, --outputExtension [ext]&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L141"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;set default file extension for all outputs&#39;</span></span>
<span class="line" id="L142"><span style="color: #24292EFF">    )</span></span>
<span class="line" id="L143"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">.parse</span><span style="color: #24292EFF">(args)</span></span>
<span class="line" id="L144"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">commander</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">args</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">length</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L145"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> { </span><span style="color: #D32F2F">...</span><span style="color: #1976D2">commander</span><span style="color: #6F42C1">.opts</span><span style="color: #24292EFF">()</span><span style="color: #212121">,</span><span style="color: #24292EFF"> args</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">commander</span><span style="color: #24292EFF">.args }</span></span>
<span class="line" id="L146"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">cmdLineNormalise</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L147"><span style="color: #24292EFF">    </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L148"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">cmdLineSanityCheck</span><span style="color: #24292EFF">(config)</span></span>
<span class="line empty-line" id="L149"></span>
<span class="line" id="L150"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">documentAll</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L151"><span style="color: #24292EFF">  } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L152"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.log</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">commander</span><span style="color: #6F42C1">.helpInformation</span><span style="color: #24292EFF">())</span></span>
<span class="line" id="L153"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L154"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L155"></span>
<span class="line empty-line" id="L156"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>Three configuration functions are called:</p>
<ul>
<li><code>cmdLineNormalise()</code> – expands some command line options to objects</li>
<li><code>configure()</code> – enriches configuration options with full paths etc.</li>
<li><code>cmdLineSanityCheck()</code> – checks that files and folders actually exist.</li>
</ul>
<p>Here is an explanation of what each one does, followed by their source code.</p>
<h3 id="step-1-cmdlinenormalise"><strong>Step 1: <code>cmdLineNormalise()</code></strong></h3>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>It’s important to understand that Docco Next can be used as a library as well as
a command line program.
Two of the command line options, <code>marked</code> and <code>languages</code>, are external JSON
files. When used as a library, Docco Next will expect <code>marked</code> and <code>languages</code> to be
objects. However, when run as a command line program, those options will
contain a string with a (JSON) file name instead.</p>
<p>The <code>cmdLineNormalise()</code> function is used to convert those strings into
Javascript objects which will depend on the contents of the corresponding
JSON files
The fuction also assigns <code>config.args</code> (which is the list of files to be
converted) to <code>config.sources</code>.</p>
<p>To sum up: when using Docco Next as a library, <code>config.languages</code> and <code>config.maked</code>
will need to be objects. However, from the command line, they will be the paths of
JSON files, and will be converted to objects by <code>cmdLineNormalise()</code>, which
reads:</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 184;"><span class="line" id="L184"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">cmdLineNormalise</span><span style="color: #24292EFF"> (config) {</span></span>
<span class="line" id="L185"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages) {</span></span>
<span class="line" id="L186"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages))) {</span></span>
<span class="line" id="L187"><span style="color: #24292EFF">      </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Languages file not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages)</span></span>
<span class="line" id="L188"><span style="color: #24292EFF">      </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">5</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L189"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L190"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">languages</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.readFile</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages)</span></span>
<span class="line" id="L191"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">JSON</span><span style="color: #6F42C1">.parse</span><span style="color: #24292EFF">(languages)</span></span>
<span class="line" id="L192"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L193"></span>
<span class="line" id="L194"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin) {</span></span>
<span class="line" id="L195"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin))) {</span></span>
<span class="line" id="L196"><span style="color: #24292EFF">      </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Plugin file not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin)</span></span>
<span class="line" id="L197"><span style="color: #24292EFF">      </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">5</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L198"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L199"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">require</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.cwd</span><span style="color: #24292EFF">()</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin))</span></span>
<span class="line" id="L200"><span style="color: #24292EFF">  } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L201"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.plugin </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}</span></span>
<span class="line" id="L202"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L203"></span>
<span class="line" id="L204"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.outputExtension) </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.outputExtension </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;html&#39;</span></span>
<span class="line empty-line" id="L205"></span>
<span class="line" id="L206"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked) {</span></span>
<span class="line" id="L207"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked))) {</span></span>
<span class="line" id="L208"><span style="color: #24292EFF">      </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Marked file not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked)</span></span>
<span class="line" id="L209"><span style="color: #24292EFF">      </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">6</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L210"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L211"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">marked</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.readFile</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked)</span></span>
<span class="line" id="L212"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">JSON</span><span style="color: #6F42C1">.parse</span><span style="color: #24292EFF">(marked)</span></span>
<span class="line" id="L213"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L214"></span>
<span class="line" id="L215"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.args</span></span>
<span class="line" id="L216"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L217"></span>
<span class="line empty-line" id="L218"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <h3 id="step-2-configure"><strong>Step 2: <code>configure()</code></strong></h3>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>This function is different to the other two <code>cmdLineNormalise()</code> and
<code>cmdLineSanityCheck()</code>: rather than being a command line-only normalisation
function, it’s actually a function that is run <em>every time</em> an API call is
invoked. (Note that once it’s run once, it sets the <code>config.configured</code>
property in the <code>config</code> object, and will check this property so that it will
ever do anything only the first time it’s invoked)</p>
<p>This function is responsible to set sane defaults in the <code>config</code> property,
so that each function doesn’t need to worry with wasteful checking.</p>
<p>For example <code>config.output</code> will be set as <code>docs</code> by default.</p>
<p>Also, for passed properties such as <code>languages</code> or <code>marked</code>, this function
makes sure that the passed options are <em>added</em> to sane defaults. For example
by passing the <code>marked</code> property in the config object, this function makes
sure that the default <code>smartypants: true</code> is on, and any configuration
options are added on <em>top</em> of what the user has passed. Or, that the
config.languages contains the used-defined languages, <em>as well as</em> the
default ones.</p>
<p>This function also sets some indirect configuration options that are not meant
to be passed by the developer, but that are a result of the configuration.</p>
<p>Finally, this function also makes sure that the passed config makes sense:
<code>config.sources</code> is scanned and any source with an unknown language (that is,
a language not in the <code>languages</code> array) is filtered out (with a warning).</p>
<p>You can see this function as insurance that there is a solid, valid <code>config</code>
object that every call can use. This is why every single function that uses
<code>config</code> will call <code>configure</code> first.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 251;"><span class="line" id="L251"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF"> (config) {</span></span>
<span class="line" id="L252"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.configured) </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L253"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.configured </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">true</span></span>
<span class="line empty-line" id="L254"></span>
<span class="line" id="L255"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;docs&#39;</span></span>
<span class="line empty-line" id="L256"></span>
<span class="line" id="L257"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">properObjectWithKeys</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages)</span></span>
<span class="line" id="L258"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> { </span><span style="color: #D32F2F">...</span><span style="color: #24292EFF">defaultLanguages</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">...</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages }</span></span>
<span class="line" id="L259"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> defaultLanguages</span></span>
<span class="line empty-line" id="L260"></span>
<span class="line" id="L261"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">properObjectWithKeys</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked)</span></span>
<span class="line" id="L262"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> { </span><span style="color: #D32F2F">...</span><span style="color: #24292EFF">defaultMarkedOptions</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">...</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked }</span></span>
<span class="line" id="L263"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> defaultMarkedOptions</span></span>
<span class="line empty-line" id="L264"></span>
<span class="line" id="L265"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;default&#39;</span></span>
<span class="line" id="L266"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #6F42C1">.</span><span style="color: #1976D2">layout</span><span style="color: #6F42C1">.match</span><span style="color: #24292EFF">(</span><span style="color: #22863A">/</span><span style="color: #D32F2F">^</span><span style="color: #22863A">[a-zA-Z0-9]</span><span style="color: #D32F2F">+$</span><span style="color: #22863A">/</span><span style="color: #24292EFF">)) {</span></span>
<span class="line" id="L267"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(__dirname</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;layouts&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout)</span></span>
<span class="line" id="L268"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L269"></span>
<span class="line" id="L270"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.css) </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.css </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;docco.css&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line" id="L271"></span>
<span class="line" id="L272"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.public </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;public&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line" id="L273"></span>
<span class="line" id="L274"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.template) {</span></span>
<span class="line" id="L275"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.template </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;docco.ejs&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L276"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L277"></span>
<span class="line" id="L278"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> {}</span></span>
<span class="line empty-line" id="L279"></span>
<span class="line" id="L280"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #6F42C1">.</span><span style="color: #1976D2">sources</span><span style="color: #6F42C1">.filter</span><span style="color: #24292EFF">((source) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L281"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">there</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">getLanguage</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L282"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">there) {</span></span>
<span class="line" id="L283"><span style="color: #24292EFF">      </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.warn</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L284"><span style="color: #24292EFF">        </span><span style="color: #22863A">`docco: file not processed, language not supported: (</span><span style="color: #D32F2F">${</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L285"><span style="color: #24292EFF">          source</span></span>
<span class="line" id="L286"><span style="color: #24292EFF">        )</span><span style="color: #D32F2F">}</span><span style="color: #22863A">)`</span></span>
<span class="line" id="L287"><span style="color: #24292EFF">      )</span></span>
<span class="line" id="L288"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L289"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> there</span></span>
<span class="line" id="L290"><span style="color: #24292EFF">  })</span></span>
<span class="line" id="L291"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L292"></span>
<span class="line empty-line" id="L293"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h3 id="step-3-cmdlinesanitycheck"><strong>Step 3: <code>cmdLineSanityCheck()</code></strong></h3>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>The <code>cmdLineSanityCheck()</code> is a command line-only function, which
is used to make sure that paths specified in the <code>config</code> object
have corresponding files or directories.</p>
<p>For example <code>config.output</code> represents the directory where all output files
will be written. If that directory doesn’t exist, Docco Next (as run from the command
line) will refuse to work.
The same applies to <code>config.layout</code> (the path to the layout, which is effectively
the “theme” used), <code>config.css</code> (the alternative CSS file used), and all files
specified in the <code>sources</code> array.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 306;"><span class="line" id="L306"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">cmdLineSanityCheck</span><span style="color: #24292EFF"> (config) {</span></span>
<span class="line" id="L307"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">dirExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output))) {</span></span>
<span class="line" id="L308"><span style="color: #24292EFF">    </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Output directory not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output)</span></span>
<span class="line" id="L309"><span style="color: #24292EFF">    </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">1</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L310"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L311"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">dirExists</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout))) {</span></span>
<span class="line" id="L312"><span style="color: #24292EFF">    </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Layout directory not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.layout)</span></span>
<span class="line" id="L313"><span style="color: #24292EFF">    </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">2</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L314"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L315"></span>
<span class="line" id="L316"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/*</span></span>
<span class="line" id="L317"><span style="color: #C2C3C5">  if (config.css &amp;&amp; !await fileExists(config.css)) {</span></span>
<span class="line" id="L318"><span style="color: #C2C3C5">    console.error(&#39;CSS file not found:&#39;, config.css)</span></span>
<span class="line" id="L319"><span style="color: #C2C3C5">    process.exit(3)</span></span>
<span class="line" id="L320"><span style="color: #C2C3C5">  }</span></span>
<span class="line" id="L321"><span style="color: #C2C3C5">  */</span></span>
<span class="line empty-line" id="L322"></span>
<span class="line" id="L323"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources) {</span></span>
<span class="line" id="L324"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">source</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources) {</span></span>
<span class="line" id="L325"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (source </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF">(source))) {</span></span>
<span class="line" id="L326"><span style="color: #24292EFF">        </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;source file not found:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> source)</span></span>
<span class="line" id="L327"><span style="color: #24292EFF">        </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">5</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L328"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L329"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L330"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L331"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L332"></span>
<span class="line empty-line" id="L333"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <h2 id="going-through-each-file-via-documentone-and-documentall">Going through each file via documentOne() and documentAll()</h2>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>Up to this point, it’s all been about preparing the ground for the program
to run: processing of command line options, sanitising the configuration object,
and so on.</p>
<p>It’s time to get to the actual work: scanning the <code>sources</code> array, and actually
get the documentation create and copied, which happens thanks to the
calls <code>documentAll()</code> and <code>documentOne()</code>.</p>
<p>First of all, some important file-related utility functions are created – some
of them are very generic, while some others are very specific to Docco Next.</p>
<p>The functions are:</p>
<ul>
<li><code>dirExists()</code> – checks if a directory exists</li>
<li><code>fileExists()</code> – checks if a file exists</li>
<li><code>finalPath()</code> – works out the final path of a file, depeding of <code>config.output</code>
and allowing a change of extension</li>
<li><code>copyAsset()</code> – copies a file or a directory into <code>config.output</code>, preserving
the path relative to the destination. So <code>some/other/file.html</code> will be copied
to <code>docs/some/other/file.html</code></li>
<li><code>write()</code> – simply writes a file to its destination</li>
</ul>
<p>There are also some utility functions that are not file-related:</p>
<ul>
<li><code>properObjectWithKeys()</code> – returns <code>true</code> if the passed variable
is an proper (not-null) object that is not empty</li>
<li><code>getLanguage(source, config)</code> - TODO: explain what it actually does</li>
</ul>
<p>Here is the code for those functions:</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 365;"><span class="line" id="L365"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">dirExists</span><span style="color: #24292EFF"> (dir) {</span></span>
<span class="line" id="L366"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.pathExists</span><span style="color: #24292EFF">(dir)) {</span></span>
<span class="line" id="L367"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">stat</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.lstat</span><span style="color: #24292EFF">(dir)</span></span>
<span class="line" id="L368"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">stat</span><span style="color: #6F42C1">.isDirectory</span><span style="color: #24292EFF">()</span></span>
<span class="line" id="L369"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L370"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">false</span></span>
<span class="line" id="L371"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L372"></span>
<span class="line" id="L373"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF"> (dir) {</span></span>
<span class="line" id="L374"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.pathExists</span><span style="color: #24292EFF">(dir)) {</span></span>
<span class="line" id="L375"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">stat</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.lstat</span><span style="color: #24292EFF">(dir)</span></span>
<span class="line" id="L376"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">stat</span><span style="color: #6F42C1">.isFile</span><span style="color: #24292EFF">() </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">stat</span><span style="color: #6F42C1">.isSymbolicLink</span><span style="color: #24292EFF">()</span></span>
<span class="line" id="L377"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L378"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">false</span></span>
<span class="line" id="L379"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L380"></span>
<span class="line" id="L381"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">finalPath</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config) {</span></span>
<span class="line" id="L382"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">ext</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.outputExtension</span></span>
<span class="line" id="L383"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L384"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output</span><span style="color: #212121">,</span></span>
<span class="line" id="L385"><span style="color: #24292EFF">    </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.dirname</span><span style="color: #24292EFF">(source)</span><span style="color: #212121">,</span></span>
<span class="line" id="L386"><span style="color: #24292EFF">    </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.extname</span><span style="color: #24292EFF">(source)) </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;.&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> ext</span></span>
<span class="line" id="L387"><span style="color: #24292EFF">  )</span></span>
<span class="line" id="L388"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L389"></span>
<span class="line" id="L390"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">copyAsset</span><span style="color: #24292EFF"> (file</span><span style="color: #212121">,</span><span style="color: #24292EFF"> type</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L391"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L392"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">file) </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L393"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (type </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;file&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">fileExists</span><span style="color: #24292EFF">(file))) </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L394"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (type </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;directory&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">(</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">dirExists</span><span style="color: #24292EFF">(file))) </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L395"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.copy</span><span style="color: #24292EFF">(file</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(file)))</span></span>
<span class="line" id="L396"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L397"></span>
<span class="line" id="L398"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">write</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> path</span><span style="color: #212121">,</span><span style="color: #24292EFF"> contents) {</span></span>
<span class="line" id="L399"><span style="color: #24292EFF">  </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.log</span><span style="color: #24292EFF">(</span><span style="color: #22863A">`docco: </span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">source</span><span style="color: #D32F2F">}</span><span style="color: #22863A"> -&gt; </span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">path</span><span style="color: #D32F2F">}</span><span style="color: #22863A">`</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L400"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.outputFile</span><span style="color: #24292EFF">(path</span><span style="color: #212121">,</span><span style="color: #24292EFF"> contents)</span></span>
<span class="line" id="L401"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L402"></span>
<span class="line" id="L403"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">properObjectWithKeys</span><span style="color: #24292EFF"> (o) {</span></span>
<span class="line" id="L404"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">typeof</span><span style="color: #24292EFF"> o </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;object&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> o </span><span style="color: #D32F2F">!==</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">null</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">Object</span><span style="color: #6F42C1">.keys</span><span style="color: #24292EFF">(o).</span><span style="color: #1976D2">length</span></span>
<span class="line" id="L405"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L406"></span>
<span class="line" id="L407"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">getLanguage</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L408"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line empty-line" id="L409"></span>
<span class="line" id="L410"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> codeExt</span><span style="color: #212121">,</span><span style="color: #24292EFF"> codeLang</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lang</span></span>
<span class="line empty-line" id="L411"></span>
<span class="line" id="L412"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">ext</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span></span>
<span class="line" id="L413"><span style="color: #24292EFF">    </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.inputExtension </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.extname</span><span style="color: #24292EFF">(source) </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(source)</span></span>
<span class="line" id="L414"><span style="color: #24292EFF">  lang </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages[ext]</span></span>
<span class="line" id="L415"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">lang) </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L416"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.name </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;markdown&#39;</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L417"><span style="color: #24292EFF">    codeExt </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.extname</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> ext))</span></span>
<span class="line" id="L418"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (codeExt) {</span></span>
<span class="line" id="L419"><span style="color: #24292EFF">      codeLang </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.languages[codeExt]</span></span>
<span class="line" id="L420"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (codeLang) {</span></span>
<span class="line" id="L421"><span style="color: #24292EFF">        lang </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> { </span><span style="color: #D32F2F">...</span><span style="color: #24292EFF">codeLang</span><span style="color: #212121">,</span><span style="color: #24292EFF"> literate</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">true</span><span style="color: #24292EFF"> }</span></span>
<span class="line" id="L422"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L423"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L424"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L425"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Add commentMatcher */</span></span>
<span class="line" id="L426"><span style="color: #24292EFF">  </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.commentMatcher </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">RegExp</span><span style="color: #24292EFF">(</span><span style="color: #22863A">`^\\s*</span><span style="color: #D32F2F">${</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.symbol</span><span style="color: #D32F2F">}</span><span style="color: #22863A">\\s?`</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L427"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Add commentFilter */</span></span>
<span class="line" id="L428"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Ignore [hashbangs](http://en.wikipedia.org/wiki/Shebang_%28Unix%29) and interpolations... */</span></span>
<span class="line" id="L429"><span style="color: #24292EFF">  </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.commentFilter </span><span style="color: #D32F2F">=</span><span style="color: #22863A"> /(</span><span style="color: #D32F2F">^</span><span style="color: #22863A">#![/]</span><span style="color: #D32F2F">|^</span><span style="color: #22863A">\s</span><span style="color: #D32F2F">*</span><span style="color: #22863A">#\{)/</span></span>
<span class="line empty-line" id="L430"></span>
<span class="line" id="L431"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> lang</span></span>
<span class="line" id="L432"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L433"></span>
<span class="line empty-line" id="L434"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Now that everything <em>really is</em> ready, it’s time to (finally!) go through
the <code>source</code> array and run <code>documentOne()</code> on each one of them. Also,
if the sources are being converted to HTML, the <code>css</code> file and the <code>public</code> directory
for that layout are copied over using the <code>copyAsset</code> utility function</p>
<p>Note that <code>configure()</code> is run. Since <code>configure()</code> only ever does anything
the first time it’s run, and since it was already run in the <code>run()</code> function,
it may seem superfluous to run it again. However, keep in mind that
Docco Next exports an API. So, every call that receives <code>config</code> will always
run <code>configure(config)</code> to make sure that sane defaults are set.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 445;"><span class="line" id="L445"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">documentAll</span><span style="color: #24292EFF"> (config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L446"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L447"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.mkdirs</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output)</span></span>
<span class="line empty-line" id="L448"></span>
<span class="line" id="L449"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">source</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources) {</span></span>
<span class="line" id="L450"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">documentOne</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L451"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L452"></span>
<span class="line" id="L453"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">copyAsset</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.css</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;file&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L454"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">copyAsset</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.public</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;directory&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L455"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L456"></span>
<span class="line empty-line" id="L457"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p><code>documentOne</code> is the centrepiece of the program: it uses the important
parsing and manipulation functions (which are also available as API) to
write the HTML file to the specified output path (<code>docs</code> by default)
This function will:</p>
<ul>
<li>Read a file</li>
<li>figures out which language it’s written in</li>
<li>If a language is literate (see: <code>.litcoffee</code> or <code>.md</code>), convert it to
code first using <code>litToCode()</code>. This is to ensure that <code>parse()</code> (the next
call) always receives “normal”, runnable code (which is what it expects)</li>
<li>Run <code>parse()</code> which will parse the file into an array of <code>sections</code>, where
each element has the properties <code>docsText</code> and <code>codeText</code></li>
<li>Run <code>formatAsHtml()</code> which  returns a formatted, finalised, ready-to-go
HTML string based on the array of sections passed</li>
<li>Write the file to its destination directory</li>
</ul>
<p>Here is the source code:</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 475;"><span class="line" id="L475"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">documentOne</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L476"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line" id="L477"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* console.log(source) */</span></span>
<span class="line empty-line" id="L478"></span>
<span class="line" id="L479"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">buffer</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.readFile</span><span style="color: #24292EFF">(source)</span></span>
<span class="line" id="L480"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> lines </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">buffer</span><span style="color: #6F42C1">.toString</span><span style="color: #24292EFF">()</span><span style="color: #6F42C1">.split</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;\n&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L481"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">finalPath</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line empty-line" id="L482"></span>
<span class="line" id="L483"><span style="color: #24292EFF">  </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.lang </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">getLanguage</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L484"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.lang) {</span></span>
<span class="line" id="L485"><span style="color: #24292EFF">    </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.warn</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L486"><span style="color: #24292EFF">      </span><span style="color: #22863A">`docco: file not processed, language not supported: (</span><span style="color: #D32F2F">${</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L487"><span style="color: #24292EFF">        source</span></span>
<span class="line" id="L488"><span style="color: #24292EFF">      )</span><span style="color: #D32F2F">}</span><span style="color: #22863A">)`</span></span>
<span class="line" id="L489"><span style="color: #24292EFF">    )</span></span>
<span class="line" id="L490"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span></span>
<span class="line" id="L491"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L492"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.literate) {</span></span>
<span class="line" id="L493"><span style="color: #24292EFF">    lines </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">litToCode</span><span style="color: #24292EFF">(lines</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line" id="L494"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L495"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">sections</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">parse</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lines</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line empty-line" id="L496"></span>
<span class="line" id="L497"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">result</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">formatAsHtml</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line empty-line" id="L498"></span>
<span class="line" id="L499"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">write</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> path</span><span style="color: #212121">,</span><span style="color: #24292EFF"> result)</span></span>
<span class="line" id="L500"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L501"></span>
<span class="line empty-line" id="L502"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <h2 id="the-actual-parsing-and-manipulation">The actual parsing and manipulation</h2>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>As explained above, <code>documentOne()</code> is Docco Next’s centrepiece, calling
<code>litToCode()</code>, <code>parse()</code>, <code>formatAsHtml</code>, and finally <code>write()</code>.</p>
<p>These functions are indeed the core functionalities of Docco Next.</p>
<h2 id="littocode">litToCode()</h2>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>This function takes literal code and returns “proper” source code that is
ready to be executed. It does this by simply de-intending Markdown-indented
code, and adding a comment marker to any other line. So, for example:</p>
<pre><code><pre class="shiki" style="background-color: transparent"><code ><span class="line"><span style="color: #24292EFF">This is a </span><span style="color: #1976D2">literate</span><span style="color: #24292EFF"> .md file that contains </span><span style="color: #1976D2">code</span><span style="color: #24292EFF">. This is the full</span></span>
<span class="line"><span style="color: #24292EFF">extent </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> the program</span><span style="color: #212121">:</span></span>
<span class="line empty-line"></span>
<span class="line"><span style="color: #24292EFF">    </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.log</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Hello world!&quot;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line"></span>
<span class="line"><span style="color: #24292EFF">This is it</span><span style="color: #D32F2F">!</span></span></code></pre></code></pre><p>Is transformed into actually executable code:</p>
<pre><code><pre class="shiki" style="background-color: transparent"><code ><span class="line"><span style="color: #24292EFF"># This is a </span><span style="color: #1976D2">literate</span><span style="color: #24292EFF"> .md file that contains </span><span style="color: #1976D2">code</span><span style="color: #24292EFF">. This is the full</span></span>
<span class="line"><span style="color: #24292EFF"># extent </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> the program</span><span style="color: #212121">:</span></span>
<span class="line empty-line"></span>
<span class="line"><span style="color: #1976D2">console</span><span style="color: #6F42C1">.log</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&quot;Hello world!&quot;</span><span style="color: #24292EFF">)</span></span>
<span class="line empty-line"></span>
<span class="line"><span style="color: #24292EFF"># This is it</span><span style="color: #D32F2F">!</span></span></code></pre></code></pre><p>This step will only be taken in cases where the input file is
literate code, which is true for those languages in <code>languages.json</code> where
the flag <code>literate</code> is set to true, <em>or</em> when the file is
for example <code>something.js.md</code> – that is, a Markdown file that
contains Javascript</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 538;"><span class="line" id="L538"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">litToCode</span><span style="color: #24292EFF"> (lines</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config) {</span></span>
<span class="line" id="L539"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line empty-line" id="L540"></span>
<span class="line" id="L541"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.lang</span></span>
<span class="line" id="L542"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">retLines</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> []</span></span>
<span class="line" id="L543"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">markdownIndented</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #22863A"> /</span><span style="color: #D32F2F">^</span><span style="color: #22863A">([ ]</span><span style="color: #D32F2F">{4}|</span><span style="color: #22863A">[ ]</span><span style="color: #D32F2F">{0,3}</span><span style="color: #22863A">\t)/</span></span>
<span class="line" id="L544"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> inCode </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> lines[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">] </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">markdownIndented</span><span style="color: #6F42C1">.exec</span><span style="color: #24292EFF">(lines[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">])</span></span>
<span class="line empty-line" id="L545"></span>
<span class="line" id="L546"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/** Remembering that a source code line are those without leading &quot;   &quot;:</span></span>
<span class="line" id="L547"><span style="color: #C2C3C5">   * add a comment marker at the beginning of each non-code line</span></span>
<span class="line" id="L548"><span style="color: #C2C3C5">   * Take out the leading &quot;    &quot; from every code line</span></span>
<span class="line" id="L549"><span style="color: #C2C3C5">   **/</span></span>
<span class="line" id="L550"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> [</span><span style="color: #1976D2">i</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">line</span><span style="color: #24292EFF">] </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lines</span><span style="color: #6F42C1">.entries</span><span style="color: #24292EFF">()) {</span></span>
<span class="line" id="L551"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/**</span></span>
<span class="line" id="L552"><span style="color: #C2C3C5">      Empty lines are a special case:</span></span>
<span class="line" id="L553"><span style="color: #C2C3C5">        - in code, they must stay blank.</span></span>
<span class="line" id="L554"><span style="color: #C2C3C5">        - In doc, they myst include the comment marker</span></span>
<span class="line" id="L555"><span style="color: #C2C3C5">    **/</span></span>
<span class="line" id="L556"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">emptyLine</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #22863A"> /</span><span style="color: #D32F2F">^</span><span style="color: #22863A">\s</span><span style="color: #D32F2F">*$</span><span style="color: #22863A">/</span><span style="color: #6F42C1">.test</span><span style="color: #24292EFF">(line)</span></span>
<span class="line" id="L557"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* Non-empty lines are added depending on them being code or doc. */</span></span>
<span class="line" id="L558"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">emptyLine) {</span></span>
<span class="line" id="L559"><span style="color: #24292EFF">      inCode </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">markdownIndented</span><span style="color: #6F42C1">.exec</span><span style="color: #24292EFF">(line)</span></span>
<span class="line" id="L560"><span style="color: #24292EFF">      retLines[i] </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> inCode</span></span>
<span class="line" id="L561"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">line</span><span style="color: #6F42C1">.slice</span><span style="color: #24292EFF">(inCode[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">].</span><span style="color: #1976D2">length</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L562"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.symbol </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39; &#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> line</span></span>
<span class="line" id="L563"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* The concept of &quot;empty&quot; changes whether we are in code or not */</span></span>
<span class="line" id="L564"><span style="color: #24292EFF">    } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L565"><span style="color: #24292EFF">      retLines[i] </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> inCode </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.symbol</span></span>
<span class="line" id="L566"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L567"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L568"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> retLines</span></span>
<span class="line" id="L569"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L570"></span>
<span class="line empty-line" id="L571"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <h2 id="parse">parse()</h2>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>This function takes a string representing the source code, and returns
an array of <code>sections</code>. Each section has two properties: <code>docsText</code> (the
documentation text, formatted with Markdown) and <code>codeText</code> (the code
displayed underneath the text in <code>docsText</code>).</p>
<p>Basically, each “section” is made up of two chunks: one formatted as
Markdown, <em>followed</em> by a piece of code.</p>
<p>There are two main cases: one for non-empty lines, and one for empty lines.</p>
<p>Non-empty lines can be either “comments” (which will end up in <code>docsText</code>) or
code (which will end up in <code>codeText</code>). It’s crucial to understand that
the flow works by adding comment lines to <code>docsText</code>, then (once a code line
is found) adding code lines to <code>codeText</code>, and when a comment line is
found again a new section is created, the two variables are reset, and everythig
starts again.</p>
<p>In more technical terms, the flow starts with empty <code>docsText</code> and
<code>codeText</code>; the function will append comment lines to <code>docsText</code> (with
<code>codeText</code> being empty) until a code line is encountered.
At that point it will append to <code>codeText</code>; however, when the next
comment line (destined to <code>docsText</code>) is encountered, since <code>codeText</code> is
<em>not</em> empty, a new section containing <code>docsText</code> and <code>codeText</code> is created
and both those variables are cleared; the commented line that triggered the
new section is then added to <code>docsText</code> (with a now empty <code>codeText</code>),
and everything starts again. Basically, in the flow <em>you know if you are in the
middle of code if <code>codeText</code> is empty</em>.</p>
<p>Empty lines are… empty, both for doc and code. To know where to add
the empty line (<code>codeText</code> or <code>docsText</code>), the same assumption as above is
used: if there is anything in <code>codeText</code>, it means that the parser is
in the middle of a code section, and therefore the empty line will be
added to that code section.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 606;"><span class="line" id="L606"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">parse</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lines</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L607"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> codeText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> docsText</span></span>
<span class="line" id="L608"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">sections</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> []</span></span>
<span class="line empty-line" id="L609"></span>
<span class="line" id="L610"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line empty-line" id="L611"></span>
<span class="line" id="L612"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.lang</span></span>
<span class="line" id="L613"><span style="color: #24292EFF">  docsText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> codeText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L614"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> lineNumber </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span></span>
<span class="line" id="L615"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> startLineNumber </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">1</span></span>
<span class="line" id="L616"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> line </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> lines) {</span></span>
<span class="line" id="L617"><span style="color: #24292EFF">    lineNumber</span><span style="color: #D32F2F">++</span></span>
<span class="line" id="L618"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* If the line is not empty, it will either go in the code section */</span></span>
<span class="line" id="L619"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* or the docs section, depending on whether the comment character was */</span></span>
<span class="line" id="L620"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* found at the beginning of the line */</span></span>
<span class="line" id="L621"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (line) {</span></span>
<span class="line" id="L622"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* Case #1: it&#39;s a &quot;comment&quot; */</span></span>
<span class="line" id="L623"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/*  Text will go in docsText as documentation */</span></span>
<span class="line" id="L624"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">line</span><span style="color: #6F42C1">.match</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.commentMatcher) </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">!</span><span style="color: #1976D2">line</span><span style="color: #6F42C1">.match</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.commentFilter)) {</span></span>
<span class="line" id="L625"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/*</span></span>
<span class="line" id="L626"><span style="color: #C2C3C5">          DETOUR: If there is code in codeText already, close off that section</span></span>
<span class="line" id="L627"><span style="color: #C2C3C5">          the section by pushing it into `sections` and zeroing</span></span>
<span class="line" id="L628"><span style="color: #C2C3C5">         `docsText` and `codeText`</span></span>
<span class="line" id="L629"><span style="color: #C2C3C5">        */</span></span>
<span class="line" id="L630"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (codeText) {</span></span>
<span class="line" id="L631"><span style="color: #24292EFF">          </span><span style="color: #1976D2">sections</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">({ docsText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> codeText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> startLineNumber })</span></span>
<span class="line" id="L632"><span style="color: #24292EFF">          docsText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> codeText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L633"><span style="color: #24292EFF">        }</span></span>
<span class="line empty-line" id="L634"></span>
<span class="line" id="L635"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* Add the line to the documentation (docsText) taking out the leading */</span></span>
<span class="line" id="L636"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* comment marker */</span></span>
<span class="line" id="L637"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.symbol) {</span></span>
<span class="line" id="L638"><span style="color: #24292EFF">          line </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">line</span><span style="color: #6F42C1">.replace</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.commentMatcher</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L639"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L640"><span style="color: #24292EFF">        docsText </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> line </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;\n&#39;</span></span>
<span class="line empty-line" id="L641"></span>
<span class="line" id="L642"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* If the line was a new markdown section (`===`,  `---` or `##`), */</span></span>
<span class="line" id="L643"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* close off that section */</span></span>
<span class="line" id="L644"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #22863A">/</span><span style="color: #D32F2F">^</span><span style="color: #22863A">(---</span><span style="color: #D32F2F">+|</span><span style="color: #22863A">===</span><span style="color: #D32F2F">+|</span><span style="color: #22863A">#</span><span style="color: #D32F2F">+</span><span style="color: #22863A">.</span><span style="color: #D32F2F">*</span><span style="color: #22863A">)</span><span style="color: #D32F2F">$</span><span style="color: #22863A">/</span><span style="color: #6F42C1">.test</span><span style="color: #24292EFF">(line)) {</span></span>
<span class="line" id="L645"><span style="color: #24292EFF">          </span><span style="color: #1976D2">sections</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">({ docsText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> codeText })</span></span>
<span class="line" id="L646"><span style="color: #24292EFF">          docsText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> codeText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L647"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L648"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* Case #2: it&#39;s not a comment */</span></span>
<span class="line" id="L649"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* Note that from this moment on `codeText` is no longer empty, */</span></span>
<span class="line" id="L650"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* which means that the next comment line (destined to docsText) will */</span></span>
<span class="line" id="L651"><span style="color: #24292EFF">        </span><span style="color: #C2C3C5">/* trigger a new section */</span></span>
<span class="line" id="L652"><span style="color: #24292EFF">      } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L653"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (codeText </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L654"><span style="color: #24292EFF">          startLineNumber </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> lineNumber</span></span>
<span class="line" id="L655"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L656"><span style="color: #24292EFF">        codeText </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> line </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;\n&#39;</span></span>
<span class="line" id="L657"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L658"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* If it&#39;s an empty line, it will go either in the */</span></span>
<span class="line" id="L659"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* code section or in the docs section. */</span></span>
<span class="line" id="L660"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* We know we are in the code section by checking if */</span></span>
<span class="line" id="L661"><span style="color: #24292EFF">      </span><span style="color: #C2C3C5">/* there is any code in codeText yet */</span></span>
<span class="line" id="L662"><span style="color: #24292EFF">    } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L663"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (codeText) codeText </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> line </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;\n&#39;</span></span>
<span class="line" id="L664"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> docsText </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> line </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;\n&#39;</span></span>
<span class="line" id="L665"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L666"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L667"><span style="color: #24292EFF">  </span><span style="color: #1976D2">sections</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">({ docsText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> codeText</span><span style="color: #212121">,</span><span style="color: #24292EFF"> startLineNumber })</span></span>
<span class="line empty-line" id="L668"></span>
<span class="line" id="L669"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> sections</span></span>
<span class="line" id="L670"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L671"></span>
<span class="line" id="L672"><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">codeToHtml</span><span style="color: #24292EFF"> (highlighter</span><span style="color: #212121">,</span><span style="color: #24292EFF"> code</span><span style="color: #212121">,</span><span style="color: #24292EFF"> language</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lineNumber) {</span></span>
<span class="line" id="L673"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">htmlEscapes</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L674"><span style="color: #24292EFF">    </span><span style="color: #22863A">&#39;&amp;&#39;</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&amp;amp;&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L675"><span style="color: #24292EFF">    </span><span style="color: #22863A">&#39;&lt;&#39;</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&amp;lt;&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L676"><span style="color: #24292EFF">    </span><span style="color: #22863A">&#39;&gt;&#39;</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&amp;gt;&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L677"><span style="color: #24292EFF">    </span><span style="color: #22863A">&#39;&quot;&#39;</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&amp;quot;&#39;</span><span style="color: #212121">,</span></span>
<span class="line" id="L678"><span style="color: #24292EFF">    </span><span style="color: #22863A">&quot;&#39;&quot;</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&amp;#39;&#39;</span></span>
<span class="line" id="L679"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L680"></span>
<span class="line" id="L681"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">escapeHtml</span><span style="color: #24292EFF"> (html) {</span></span>
<span class="line" id="L682"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">html</span><span style="color: #6F42C1">.replace</span><span style="color: #24292EFF">(</span><span style="color: #22863A">/[&amp;&lt;&gt;&quot;&#39;]/</span><span style="color: #D32F2F">g</span><span style="color: #212121">,</span><span style="color: #24292EFF"> (chr) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> htmlEscapes[chr])</span></span>
<span class="line" id="L683"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L684"></span>
<span class="line" id="L685"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FontStyle</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L686"><span style="color: #24292EFF">    NotSet</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">-</span><span style="color: #1976D2">1</span><span style="color: #212121">,</span></span>
<span class="line" id="L687"><span style="color: #24292EFF">    None</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #212121">,</span></span>
<span class="line" id="L688"><span style="color: #24292EFF">    Italic</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">1</span><span style="color: #212121">,</span></span>
<span class="line" id="L689"><span style="color: #24292EFF">    Bold</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">2</span><span style="color: #212121">,</span></span>
<span class="line" id="L690"><span style="color: #24292EFF">    Underline</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">4</span></span>
<span class="line" id="L691"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L692"></span>
<span class="line" id="L693"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* See: https://github.com/shikijs/shiki/blob/f322a2b97470b25b26a4d8c1cf4892b059eb69db/packages/shiki/src/renderer.ts */</span></span>
<span class="line" id="L694"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">renderToHtml</span><span style="color: #24292EFF"> (lines</span><span style="color: #212121">,</span><span style="color: #24292EFF"> options </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L695"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">bg</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.bg </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;transparent&#39;</span></span>
<span class="line empty-line" id="L696"></span>
<span class="line" id="L697"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">hasLineNumbers</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">typeof</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.lineNumber </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;number&#39;</span></span>
<span class="line" id="L698"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lineNumber</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.lineNumber </span><span style="color: #D32F2F">??</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">1</span></span>
<span class="line empty-line" id="L699"></span>
<span class="line" id="L700"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">numberOfNonEmptyLines</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lines</span><span style="color: #6F42C1">.filter</span><span style="color: #24292EFF">((l) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">l</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">length</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&gt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">).</span><span style="color: #1976D2">length</span></span>
<span class="line" id="L701"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (numberOfNonEmptyLines </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L702"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L703"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L704"></span>
<span class="line" id="L705"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> html </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line empty-line" id="L706"></span>
<span class="line" id="L707"><span style="color: #24292EFF">    html </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`&lt;pre class=&quot;shiki&quot; style=&quot;background-color: </span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">bg</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&quot;&gt;`</span></span>
<span class="line" id="L708"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.langId) {</span></span>
<span class="line" id="L709"><span style="color: #24292EFF">      html </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`&lt;div class=&quot;language-id&quot;&gt;</span><span style="color: #D32F2F">${</span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.langId</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&lt;/div&gt;`</span></span>
<span class="line" id="L710"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L711"><span style="color: #24292EFF">    html </span><span style="color: #D32F2F">+=</span></span>
<span class="line" id="L712"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;&lt;code &#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span></span>
<span class="line" id="L713"><span style="color: #24292EFF">      (hasLineNumbers </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`style=&quot;--line-start-number: </span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">lineNumber</span><span style="color: #D32F2F">}</span><span style="color: #22863A">;&quot;`</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">) </span><span style="color: #D32F2F">+</span></span>
<span class="line" id="L714"><span style="color: #24292EFF">      </span><span style="color: #22863A">&#39;&gt;&#39;</span></span>
<span class="line empty-line" id="L715"></span>
<span class="line" id="L716"><span style="color: #24292EFF">    </span><span style="color: #1976D2">lines</span><span style="color: #6F42C1">.forEach</span><span style="color: #24292EFF">((l</span><span style="color: #212121">,</span><span style="color: #24292EFF"> idx) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L717"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lineClasses</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> [</span><span style="color: #22863A">&#39;line&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">l</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">length</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&gt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">undefined</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;empty-line&#39;</span><span style="color: #24292EFF">]</span></span>
<span class="line" id="L718"><span style="color: #24292EFF">        </span><span style="color: #6F42C1">.filter</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">Boolean</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L719"><span style="color: #24292EFF">        </span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39; &#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L720"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">currentLineId</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`L</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">lineNumber </span><span style="color: #D32F2F">+</span><span style="color: #24292EFF"> idx</span><span style="color: #D32F2F">}</span><span style="color: #22863A">`</span></span>
<span class="line empty-line" id="L721"></span>
<span class="line" id="L722"><span style="color: #24292EFF">      html </span><span style="color: #D32F2F">+=</span></span>
<span class="line" id="L723"><span style="color: #24292EFF">        </span><span style="color: #22863A">`&lt;span class=&quot;</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">lineClasses</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&quot;`</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">+</span></span>
<span class="line" id="L724"><span style="color: #24292EFF">        (hasLineNumbers </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #22863A">` id=&quot;</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">currentLineId</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&quot;`</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">) </span><span style="color: #D32F2F">+</span></span>
<span class="line" id="L725"><span style="color: #24292EFF">        </span><span style="color: #22863A">&#39;&gt;&#39;</span></span>
<span class="line empty-line" id="L726"></span>
<span class="line" id="L727"><span style="color: #24292EFF">      </span><span style="color: #1976D2">l</span><span style="color: #6F42C1">.forEach</span><span style="color: #24292EFF">((token) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L728"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">cssDeclarations</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> [</span><span style="color: #22863A">`color: </span><span style="color: #D32F2F">${</span><span style="color: #1976D2">token</span><span style="color: #24292EFF">.color </span><span style="color: #D32F2F">||</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">options</span><span style="color: #24292EFF">.fg</span><span style="color: #D32F2F">}</span><span style="color: #22863A">`</span><span style="color: #24292EFF">]</span></span>
<span class="line" id="L729"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">token</span><span style="color: #24292EFF">.fontStyle </span><span style="color: #D32F2F">&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FontStyle</span><span style="color: #24292EFF">.Italic) {</span></span>
<span class="line" id="L730"><span style="color: #24292EFF">          </span><span style="color: #1976D2">cssDeclarations</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;font-style: italic&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L731"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L732"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">token</span><span style="color: #24292EFF">.fontStyle </span><span style="color: #D32F2F">&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FontStyle</span><span style="color: #24292EFF">.Bold) {</span></span>
<span class="line" id="L733"><span style="color: #24292EFF">          </span><span style="color: #1976D2">cssDeclarations</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;font-weight: bold&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L734"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L735"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">token</span><span style="color: #24292EFF">.fontStyle </span><span style="color: #D32F2F">&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">FontStyle</span><span style="color: #24292EFF">.Underline) {</span></span>
<span class="line" id="L736"><span style="color: #24292EFF">          </span><span style="color: #1976D2">cssDeclarations</span><span style="color: #6F42C1">.push</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;text-decoration: underline&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L737"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L738"><span style="color: #24292EFF">        html </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`&lt;span style=&quot;</span><span style="color: #D32F2F">${</span><span style="color: #1976D2">cssDeclarations</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;; &#39;</span><span style="color: #24292EFF">)</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&quot;&gt;</span><span style="color: #D32F2F">${</span><span style="color: #6F42C1">escapeHtml</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L739"><span style="color: #24292EFF">          </span><span style="color: #1976D2">token</span><span style="color: #24292EFF">.content</span></span>
<span class="line" id="L740"><span style="color: #24292EFF">        )</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&lt;/span&gt;`</span></span>
<span class="line" id="L741"><span style="color: #24292EFF">      })</span></span>
<span class="line" id="L742"><span style="color: #24292EFF">      html </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&lt;/span&gt;\n&#39;</span></span>
<span class="line" id="L743"><span style="color: #24292EFF">    })</span></span>
<span class="line" id="L744"><span style="color: #24292EFF">    html </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">html</span><span style="color: #6F42C1">.replace</span><span style="color: #24292EFF">(</span><span style="color: #22863A">/\n</span><span style="color: #D32F2F">*$</span><span style="color: #22863A">/</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">) </span><span style="color: #C2C3C5">// Get rid of final new lines</span></span>
<span class="line" id="L745"><span style="color: #24292EFF">    html </span><span style="color: #D32F2F">+=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&lt;/code&gt;&lt;/pre&gt;&#39;</span></span>
<span class="line empty-line" id="L746"></span>
<span class="line" id="L747"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> html</span></span>
<span class="line" id="L748"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L749"></span>
<span class="line" id="L750"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">tokens</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">highlighter</span><span style="color: #6F42C1">.codeToThemedTokens</span><span style="color: #24292EFF">(code</span><span style="color: #212121">,</span><span style="color: #24292EFF"> language)</span></span>
<span class="line empty-line" id="L751"></span>
<span class="line" id="L752"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">renderToHtml</span><span style="color: #24292EFF">(tokens</span><span style="color: #212121">,</span><span style="color: #24292EFF"> { lineNumber })</span></span>
<span class="line" id="L753"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L754"></span>
<span class="line empty-line" id="L755"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <h2 id="formatashtml">formatAsHtml()</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>This function takes the sections and format them as
HTML, alternating <code>docsText</code> and (Markdown-indented) <code>codeText</code></p>
<p>This function is essentially split into two subfunctions; they are both
run passing on all of the parameters:</p>
<ul>
<li><code>formatSections()</code></li>
<li><code>makeHtmlBlob()</code></li>
</ul>
<p>The first one, <code>formatSections()</code>, will take the <code>sections</code> array; remember:
each element has two properties, the leading <code>docsText</code> and the trailing
<code>codeText</code>. After running <code>formatSections()</code>, each element will also have
<code>docsHtml</code> and <code>codeHtml</code> (their respective HTML versions). This is done using
<code>markdown</code> for the docs, and <code>shiki</code> for the code. If a plugin was
specified, the filter <code>plugin.beforeMarked</code> will be run before feeding the text
to Marked. This allows users to extend Markdown as neeed.</p>
<p>Since Markdown documentation can <em>also</em> contain code (by indenting 4 spaces),
the <code>shiki</code> option is set for Markdown, instructing it what to do when
a code block is encountered: obviously, the <code>shiki</code> library
will be used to format it.</p>
<p>The second functtion, <code>makeHtmlBlob()</code>, actually creates the final HTML code
using the formatted sections as a starting point. The conversion is done
by using the EJS template provided, and passing it important variables:</p>
<ul>
<li><code>sources</code> – it’s the list of sources, useful to create table of contents</li>
<li><code>css</code> – it’s the path to the CSS file, relative to the processed file.</li>
<li><code>title</code> – the title of the file. If the file starts with a markdown
heading, this variable will have the contents of that heading; otherwise,
it will have the file name.</li>
<li><code>firstSectionIsTitle</code> – if true, the <code>title</code> variable is indeed the first
section’s markdown heading. Templates can use this information to write
the logic around the title.</li>
<li><code>sections</code> – array of the various sections, which include <code>docsHtml</code> and <code>codeHtml</code>.
This array is used by the EJS template to know what the file actually
contains</li>
<li><code>finalPath</code> and <code>relativeToThisFile</code> – two functions often used together
in templates to know how to (HTML) link to another file in sources. For
example <code>relativeToThisFile(finalPath(source))</code>.</li>
</ul>
<p>One note about the <code>_getTemplate()</code> function. The aim of the function is
to load the template file, and return an EJS compiler. The file itself
is memoized, so that calling <code>_getTemplate()</code> doesn’t result in multiple
reloading of the same file (since <code>formatAsHtml()</code> is potentially called
multiple times, once for each passed file). Memoization avoids using a
global variable.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 805;"><span class="line" id="L805"><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">formatAsHtml</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L806"><span style="color: #24292EFF">  </span><span style="color: #6F42C1">configure</span><span style="color: #24292EFF">(config)</span></span>
<span class="line empty-line" id="L807"></span>
<span class="line" id="L808"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.lang</span></span>
<span class="line empty-line" id="L809"></span>
<span class="line" id="L810"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Format sections, as HTML (from Markdown) or as highlighted code */</span></span>
<span class="line" id="L811"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">formatSections</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lang)</span></span>
<span class="line empty-line" id="L812"></span>
<span class="line" id="L813"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* return the HTML blob */</span></span>
<span class="line" id="L814"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">makeHtmlBlob</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lang)</span></span>
<span class="line empty-line" id="L815"></span>
<span class="line" id="L816"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Format and highlight the various section of the code, using */</span></span>
<span class="line" id="L817"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">formatSections</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}</span><span style="color: #212121">,</span><span style="color: #24292EFF"> lang) {</span></span>
<span class="line" id="L818"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">highlighter</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">shiki</span><span style="color: #6F42C1">.getHighlighter</span><span style="color: #24292EFF">({</span></span>
<span class="line" id="L819"><span style="color: #24292EFF">      theme</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.shikiTheme </span><span style="color: #D32F2F">??</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;min-light&#39;</span></span>
<span class="line" id="L820"><span style="color: #24292EFF">    })</span></span>
<span class="line empty-line" id="L821"></span>
<span class="line" id="L822"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* [Markdown](https://github.com/markedjs/marked) and Shiki */</span></span>
<span class="line" id="L823"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* Set options specified by the user, using to `smartypants: true` */</span></span>
<span class="line" id="L824"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* as a starting point */</span></span>
<span class="line" id="L825"><span style="color: #24292EFF">    </span><span style="color: #1976D2">marked</span><span style="color: #6F42C1">.setOptions</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.marked)</span></span>
<span class="line empty-line" id="L826"></span>
<span class="line" id="L827"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* Code might happen within the markdown documentation as well! If that */</span></span>
<span class="line" id="L828"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* is the case, it will highlight code either using the language specified */</span></span>
<span class="line" id="L829"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* within the Markdown codeblock, or the default language used for the processes */</span></span>
<span class="line" id="L830"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* file */</span></span>
<span class="line" id="L831"><span style="color: #24292EFF">    </span><span style="color: #1976D2">marked</span><span style="color: #6F42C1">.setOptions</span><span style="color: #24292EFF">({</span></span>
<span class="line" id="L832"><span style="color: #24292EFF">      </span><span style="color: #6F42C1">highlight</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> (code</span><span style="color: #212121">,</span><span style="color: #24292EFF"> language) {</span></span>
<span class="line" id="L833"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">!</span><span style="color: #24292EFF">language) language </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.name</span></span>
<span class="line empty-line" id="L834"></span>
<span class="line" id="L835"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L836"><span style="color: #24292EFF">          </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">codeToHtml</span><span style="color: #24292EFF">(highlighter</span><span style="color: #212121">,</span><span style="color: #24292EFF"> code</span><span style="color: #212121">,</span><span style="color: #24292EFF"> language</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">undefined</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L837"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">catch</span><span style="color: #24292EFF"> (error) {</span></span>
<span class="line" id="L838"><span style="color: #24292EFF">          </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.warn</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L839"><span style="color: #24292EFF">            </span><span style="color: #22863A">`</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">source</span><span style="color: #D32F2F">}</span><span style="color: #22863A">: language &#39;</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">language</span><span style="color: #D32F2F">}</span><span style="color: #22863A">&#39; not recognised, code block not highlighted`</span></span>
<span class="line" id="L840"><span style="color: #24292EFF">          )</span></span>
<span class="line" id="L841"><span style="color: #24292EFF">          </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> code</span></span>
<span class="line" id="L842"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L843"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L844"><span style="color: #24292EFF">    })</span></span>
<span class="line empty-line" id="L845"></span>
<span class="line" id="L846"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">for</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">section</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">of</span><span style="color: #24292EFF"> sections) {</span></span>
<span class="line" id="L847"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> code </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">codeToHtml</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L848"><span style="color: #24292EFF">        highlighter</span><span style="color: #212121">,</span></span>
<span class="line" id="L849"><span style="color: #24292EFF">        </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.codeText</span><span style="color: #212121">,</span></span>
<span class="line" id="L850"><span style="color: #24292EFF">        </span><span style="color: #1976D2">lang</span><span style="color: #24292EFF">.name</span><span style="color: #212121">,</span></span>
<span class="line" id="L851"><span style="color: #24292EFF">        </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.startLineNumber</span></span>
<span class="line" id="L852"><span style="color: #24292EFF">      )</span></span>
<span class="line empty-line" id="L853"></span>
<span class="line" id="L854"><span style="color: #24292EFF">      code </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">code</span><span style="color: #6F42C1">.replace</span><span style="color: #24292EFF">(</span><span style="color: #22863A">/\s</span><span style="color: #D32F2F">+$</span><span style="color: #22863A">/</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L855"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (code </span><span style="color: #D32F2F">!==</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span><span style="color: #24292EFF">) </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.codeHtml </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">`</span><span style="color: #D32F2F">${</span><span style="color: #24292EFF">code</span><span style="color: #D32F2F">}</span><span style="color: #22863A">`</span></span>
<span class="line" id="L856"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.codeHtml </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L857"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">plugin</span><span style="color: #24292EFF">.beforeMarked) {</span></span>
<span class="line" id="L858"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">newText</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #6F42C1">.</span><span style="color: #1976D2">plugin</span><span style="color: #6F42C1">.beforeMarked</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsText)</span></span>
<span class="line" id="L859"><span style="color: #24292EFF">        </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsText </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> newText</span></span>
<span class="line" id="L860"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L861"><span style="color: #24292EFF">      </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsHtml </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">marked</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsText)</span></span>
<span class="line empty-line" id="L862"></span>
<span class="line" id="L863"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">plugin</span><span style="color: #24292EFF">.afterHtml) {</span></span>
<span class="line" id="L864"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">newHtml</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #6F42C1">.</span><span style="color: #1976D2">plugin</span><span style="color: #6F42C1">.afterHtml</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsHtml)</span></span>
<span class="line" id="L865"><span style="color: #24292EFF">        </span><span style="color: #1976D2">section</span><span style="color: #24292EFF">.docsHtml </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> newHtml</span></span>
<span class="line" id="L866"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L867"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L868"><span style="color: #24292EFF">  }</span></span>
<span class="line empty-line" id="L869"></span>
<span class="line" id="L870"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* Once all of the code has finished highlighting, we can **write** the resulting */</span></span>
<span class="line" id="L871"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* documentation file by passing the completed HTML sections into the template, */</span></span>
<span class="line" id="L872"><span style="color: #24292EFF">  </span><span style="color: #C2C3C5">/* and rendering it to the specified output path. */</span></span>
<span class="line" id="L873"><span style="color: #24292EFF">  </span><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">makeHtmlBlob</span><span style="color: #24292EFF"> (source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> sections</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {}) {</span></span>
<span class="line" id="L874"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> first</span></span>
<span class="line empty-line" id="L875"></span>
<span class="line" id="L876"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">async</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">_getTemplate</span><span style="color: #24292EFF"> (template) {</span></span>
<span class="line" id="L877"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">formatAsHtml</span><span style="color: #24292EFF">._template) </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">formatAsHtml</span><span style="color: #24292EFF">._template</span></span>
<span class="line empty-line" id="L878"></span>
<span class="line" id="L879"><span style="color: #24292EFF">      template </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> (</span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.readFile</span><span style="color: #24292EFF">(template))</span><span style="color: #6F42C1">.toString</span><span style="color: #24292EFF">()</span></span>
<span class="line" id="L880"><span style="color: #24292EFF">      template </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">formatAsHtml</span><span style="color: #24292EFF">._template </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">ejs</span><span style="color: #6F42C1">.compile</span><span style="color: #24292EFF">(template)</span></span>
<span class="line" id="L881"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> template</span></span>
<span class="line" id="L882"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L883"></span>
<span class="line" id="L884"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">relativeToThisFile</span><span style="color: #24292EFF"> (file) {</span></span>
<span class="line" id="L885"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">from</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.resolve</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.dirname</span><span style="color: #24292EFF">(thisFile))</span></span>
<span class="line" id="L886"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">to</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.resolve</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.dirname</span><span style="color: #24292EFF">(file))</span></span>
<span class="line" id="L887"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.relative</span><span style="color: #24292EFF">(from</span><span style="color: #212121">,</span><span style="color: #24292EFF"> to)</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(file))</span></span>
<span class="line" id="L888"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L889"></span>
<span class="line" id="L890"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">function</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">includeText</span><span style="color: #24292EFF"> (source) {</span></span>
<span class="line" id="L891"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> (s</span><span style="color: #212121">,</span><span style="color: #24292EFF"> silentFail) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L892"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> contents</span></span>
<span class="line" id="L893"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> file</span></span>
<span class="line" id="L894"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.isAbsolute</span><span style="color: #24292EFF">(s)) {</span></span>
<span class="line" id="L895"><span style="color: #24292EFF">          file </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> s</span></span>
<span class="line" id="L896"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L897"><span style="color: #24292EFF">          file </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> s</span></span>
<span class="line" id="L898"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L899"><span style="color: #24292EFF">        </span><span style="color: #D32F2F">try</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L900"><span style="color: #24292EFF">          contents </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">fs</span><span style="color: #6F42C1">.readFileSync</span><span style="color: #24292EFF">(file)</span></span>
<span class="line" id="L901"><span style="color: #24292EFF">          </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> contents</span></span>
<span class="line" id="L902"><span style="color: #24292EFF">        } </span><span style="color: #D32F2F">catch</span><span style="color: #24292EFF"> (e) {</span></span>
<span class="line" id="L903"><span style="color: #24292EFF">          </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (silentFail </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">e</span><span style="color: #24292EFF">.code </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;ENOENT&#39;</span><span style="color: #24292EFF">) </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;&#39;</span></span>
<span class="line" id="L904"><span style="color: #24292EFF">          </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (</span><span style="color: #1976D2">e</span><span style="color: #24292EFF">.code </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;ENOENT&#39;</span><span style="color: #24292EFF">) {</span></span>
<span class="line" id="L905"><span style="color: #24292EFF">            </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.error</span><span style="color: #24292EFF">(</span><span style="color: #22863A">&#39;Could not load included file:&#39;</span><span style="color: #212121">,</span><span style="color: #24292EFF"> file)</span></span>
<span class="line" id="L906"><span style="color: #24292EFF">          } </span><span style="color: #D32F2F">else</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L907"><span style="color: #24292EFF">            </span><span style="color: #1976D2">console</span><span style="color: #6F42C1">.log</span><span style="color: #24292EFF">(e)</span></span>
<span class="line" id="L908"><span style="color: #24292EFF">          }</span></span>
<span class="line" id="L909"><span style="color: #24292EFF">          </span><span style="color: #1976D2">process</span><span style="color: #6F42C1">.exit</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">100</span><span style="color: #24292EFF">)</span></span>
<span class="line" id="L910"><span style="color: #24292EFF">        }</span></span>
<span class="line" id="L911"><span style="color: #24292EFF">      }</span></span>
<span class="line" id="L912"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L913"></span>
<span class="line" id="L914"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">thisFile</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">finalPath</span><span style="color: #24292EFF">(source</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span></span>
<span class="line empty-line" id="L915"></span>
<span class="line" id="L916"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* Work out `title`, which will be either the first heading in the */</span></span>
<span class="line" id="L917"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* documentation, or (as a last resort) the file name */</span></span>
<span class="line" id="L918"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">firstSection</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">sections</span><span style="color: #6F42C1">.find</span><span style="color: #24292EFF">((s) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L919"><span style="color: #24292EFF">      </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">s</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">docsText</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">length</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&gt;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">0</span></span>
<span class="line" id="L920"><span style="color: #24292EFF">    })</span></span>
<span class="line" id="L921"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">let</span><span style="color: #24292EFF"> lexed</span></span>
<span class="line" id="L922"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (firstSection) {</span></span>
<span class="line" id="L923"><span style="color: #24292EFF">      lexed </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">marked</span><span style="color: #6F42C1">.lexer</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">firstSection</span><span style="color: #24292EFF">.docsText)</span></span>
<span class="line" id="L924"><span style="color: #24292EFF">      first </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> lexed[</span><span style="color: #1976D2">0</span><span style="color: #24292EFF">]</span></span>
<span class="line" id="L925"><span style="color: #24292EFF">    }</span></span>
<span class="line" id="L926"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">maybeTitle</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> first </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">first</span><span style="color: #24292EFF">.type </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #22863A">&#39;heading&#39;</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">first</span><span style="color: #24292EFF">.depth </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">1</span></span>
<span class="line" id="L927"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">title</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> maybeTitle </span><span style="color: #D32F2F">?</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">first</span><span style="color: #24292EFF">.text </span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(source)</span></span>
<span class="line" id="L928"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">firstSectionIsTitle</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> maybeTitle </span><span style="color: #D32F2F">&amp;&amp;</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">lexed</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">length</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">===</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">1</span></span>
<span class="line empty-line" id="L929"></span>
<span class="line" id="L930"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* If the first section is the title, then get rid of it  */</span></span>
<span class="line" id="L931"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* since the title is already being displayed by the template anyway */</span></span>
<span class="line" id="L932"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">if</span><span style="color: #24292EFF"> (firstSectionIsTitle) {</span></span>
<span class="line" id="L933"><span style="color: #24292EFF">      </span><span style="color: #1976D2">sections</span><span style="color: #6F42C1">.shift</span><span style="color: #24292EFF">()</span></span>
<span class="line" id="L934"><span style="color: #24292EFF">    }</span></span>
<span class="line empty-line" id="L935"></span>
<span class="line" id="L936"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* The `css` variable will be available in the template as a relative */</span></span>
<span class="line" id="L937"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* link to the CSS file */</span></span>
<span class="line" id="L938"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">css</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">relativeToThisFile</span><span style="color: #24292EFF">(</span></span>
<span class="line" id="L939"><span style="color: #24292EFF">      </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.join</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.output</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">path</span><span style="color: #6F42C1">.basename</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.css))</span></span>
<span class="line" id="L940"><span style="color: #24292EFF">    )</span></span>
<span class="line empty-line" id="L941"></span>
<span class="line" id="L942"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">template</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">await</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">_getTemplate</span><span style="color: #24292EFF">(</span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.template)</span></span>
<span class="line empty-line" id="L943"></span>
<span class="line" id="L944"><span style="color: #24292EFF">    </span><span style="color: #C2C3C5">/* Make up the HTML based on the template */</span></span>
<span class="line" id="L945"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">const</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">html</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">template</span><span style="color: #24292EFF">({</span></span>
<span class="line" id="L946"><span style="color: #24292EFF">      lang</span><span style="color: #212121">,</span></span>
<span class="line" id="L947"><span style="color: #24292EFF">      includeText</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">includeText</span><span style="color: #24292EFF">(source)</span><span style="color: #212121">,</span></span>
<span class="line" id="L948"><span style="color: #24292EFF">      source</span><span style="color: #212121">,</span></span>
<span class="line" id="L949"><span style="color: #24292EFF">      sources</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">config</span><span style="color: #24292EFF">.sources</span><span style="color: #212121">,</span></span>
<span class="line" id="L950"><span style="color: #24292EFF">      css</span><span style="color: #212121">,</span></span>
<span class="line" id="L951"><span style="color: #24292EFF">      firstSectionIsTitle</span><span style="color: #212121">,</span></span>
<span class="line" id="L952"><span style="color: #24292EFF">      title</span><span style="color: #212121">,</span></span>
<span class="line" id="L953"><span style="color: #24292EFF">      sections</span><span style="color: #212121">,</span></span>
<span class="line" id="L954"><span style="color: #24292EFF">      </span><span style="color: #6F42C1">finalPath</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> (path) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">finalPath</span><span style="color: #24292EFF">(path</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span><span style="color: #212121">,</span></span>
<span class="line" id="L955"><span style="color: #24292EFF">      relativeToThisFile</span><span style="color: #212121">,</span></span>
<span class="line empty-line" id="L956"></span>
<span class="line" id="L957"><span style="color: #24292EFF">      hasTitle</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> firstSectionIsTitle</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #C2C3C5">// compatibility to Docco&#39;s original API</span></span>
<span class="line" id="L958"><span style="color: #24292EFF">      </span><span style="color: #6F42C1">destination</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> (path) </span><span style="color: #D32F2F">=&gt;</span><span style="color: #24292EFF"> </span><span style="color: #6F42C1">finalPath</span><span style="color: #24292EFF">(path</span><span style="color: #212121">,</span><span style="color: #24292EFF"> config)</span><span style="color: #212121">,</span><span style="color: #24292EFF"> </span><span style="color: #C2C3C5">// compatibility to Docco&#39;s original API</span></span>
<span class="line" id="L959"><span style="color: #24292EFF">      relative</span><span style="color: #D32F2F">:</span><span style="color: #24292EFF"> relativeToThisFile </span><span style="color: #C2C3C5">// compatibility to Docco&#39;s original API</span></span>
<span class="line" id="L960"><span style="color: #24292EFF">    })</span></span>
<span class="line" id="L961"><span style="color: #24292EFF">    </span><span style="color: #D32F2F">return</span><span style="color: #24292EFF"> html</span></span>
<span class="line" id="L962"><span style="color: #24292EFF">  }</span></span>
<span class="line" id="L963"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L964"></span>
<span class="line empty-line" id="L965"></span></code></pre></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <h2 id="public-api">Public API</h2>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p>These functions are available once the module is <code>required()</code>. They are
self contained and can be used to take Docco Next to different directions.</p>

            </div>
            
            <div class="content"><pre class="shiki" style="background-color: transparent"><code style="--line-start-number: 969;"><span class="line" id="L969"><span style="color: #1976D2">exports</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> </span><span style="color: #1976D2">module</span><span style="color: #24292EFF">.</span><span style="color: #1976D2">exports</span><span style="color: #24292EFF"> </span><span style="color: #D32F2F">=</span><span style="color: #24292EFF"> {</span></span>
<span class="line" id="L970"><span style="color: #24292EFF">  copyAsset</span><span style="color: #212121">,</span></span>
<span class="line" id="L971"><span style="color: #24292EFF">  run</span><span style="color: #212121">,</span></span>
<span class="line" id="L972"><span style="color: #24292EFF">  parse</span><span style="color: #212121">,</span></span>
<span class="line" id="L973"><span style="color: #24292EFF">  formatAsHtml</span><span style="color: #212121">,</span></span>
<span class="line" id="L974"><span style="color: #24292EFF">  litToCode</span><span style="color: #212121">,</span></span>
<span class="line" id="L975"><span style="color: #24292EFF">  documentOne</span><span style="color: #212121">,</span></span>
<span class="line" id="L976"><span style="color: #24292EFF">  documentAll</span><span style="color: #212121">,</span></span>
<span class="line" id="L977"><span style="color: #24292EFF">  version</span></span>
<span class="line" id="L978"><span style="color: #24292EFF">}</span></span>
<span class="line empty-line" id="L979"></span>
<span class="line" id="L980"><span style="color: #C2C3C5">/*</span></span>
<span class="line" id="L981"><span style="color: #C2C3C5">`rm -rf dir2/*; node --inspect-brk bin/docco  -o dir2 ./doccoOrig.js sub/doccoOrig.js`</span></span>
<span class="line" id="L982"><span style="color: #C2C3C5">`rm -rf dir2/*; node bin/docco  -l default -L /tmp/extras.json -o dir2 ./docco.js</span></span>
<span class="line" id="L983"><span style="color: #C2C3C5">docco: ./docco.js -&gt; dir2/docco.html</span></span>
<span class="line" id="L984"><span style="color: #C2C3C5">*/</span></span>
<span class="line empty-line" id="L985"></span>
<span class="line empty-line" id="L986"></span></code></pre></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
